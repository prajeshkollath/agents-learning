<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
html {
  font-family: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
.markmap-dark {
  background: #27272a;
  color: white;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.12/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.12/dist/index.js"></script><script>((r) => {
          setTimeout(r);
        })(() => {
  const { markmap, mm } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute("style", "position:absolute;bottom:20px;right:20px");
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
              if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                document.documentElement.classList.add("markmap-dark");
              }
            })(() => window.markmap,null,{"content":"Topic 18: Building a Prompt Chain in Python","children":[{"content":"Core Concept","children":[],"payload":{"tag":"h2","lines":"2,3"}},{"content":"The Building Block: One Helper Function","children":[{"content":"<pre data-lines=\"14,23\"><code class=\"language-python\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">call_gemini</span>(<span class=\"hljs-params\">system_prompt, user_message</span>):\n    response = client.models.generate_content(\n        model=MODEL,\n        config={<span class=\"hljs-string\">&quot;system_instruction&quot;</span>: system_prompt},\n        contents=user_message,\n    )\n    <span class=\"hljs-keyword\">return</span> response.text\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"14,23"}}],"payload":{"tag":"h2","lines":"10,11"}},{"content":"Each Step Gets Its Own System Prompt","children":[{"content":"<table data-lines=\"32,38\">\n<thead data-lines=\"32,33\">\n<tr data-lines=\"32,33\">\n<th>Step</th>\n<th>Persona</th>\n<th>Job</th>\n</tr>\n</thead>\n<tbody data-lines=\"34,38\">\n<tr data-lines=\"34,35\">\n<td>Extract</td>\n<td>Content strategist</td>\n<td>Identify key points</td>\n</tr>\n<tr data-lines=\"35,36\">\n<td>Draft</td>\n<td>Blog writer</td>\n<td>Write from key points</td>\n</tr>\n<tr data-lines=\"36,37\">\n<td>Critique</td>\n<td>Senior editor</td>\n<td>Find weaknesses</td>\n</tr>\n<tr data-lines=\"37,38\">\n<td>Polish</td>\n<td>Senior writer</td>\n<td>Rewrite with feedback</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"32,38"}}],"payload":{"tag":"h2","lines":"28,29"}},{"content":"Each Call is Independent (Not Multi-Turn)","children":[{"content":"<pre data-lines=\"48,54\"><code data-lines=\"48,54\"><span class=\"hljs-attr\">Step 1:</span> [<span class=\"hljs-attr\">System:</span> <span class=\"hljs-string\">Extract</span>] <span class=\"hljs-string\">+</span> [<span class=\"hljs-attr\">User:</span> <span class=\"hljs-string\">topic</span>]        <span class=\"hljs-string\">&#x2192;</span> <span class=\"hljs-string\">key_points</span>\n<span class=\"hljs-attr\">Step 2:</span> [<span class=\"hljs-attr\">System:</span> <span class=\"hljs-string\">Draft</span>]   <span class=\"hljs-string\">+</span> [<span class=\"hljs-attr\">User:</span> <span class=\"hljs-string\">key_points</span>]    <span class=\"hljs-string\">&#x2192;</span> <span class=\"hljs-string\">draft</span>\n<span class=\"hljs-attr\">Step 3:</span> [<span class=\"hljs-attr\">System:</span> <span class=\"hljs-string\">Critique</span>]<span class=\"hljs-string\">+</span> [<span class=\"hljs-attr\">User:</span> <span class=\"hljs-string\">draft</span>]          <span class=\"hljs-string\">&#x2192;</span> <span class=\"hljs-string\">critique</span>\n<span class=\"hljs-attr\">Step 4:</span> [<span class=\"hljs-attr\">System:</span> <span class=\"hljs-string\">Polish</span>]  <span class=\"hljs-string\">+</span> [<span class=\"hljs-attr\">User:</span> <span class=\"hljs-string\">draft+critique</span>] <span class=\"hljs-string\">&#x2192;</span> <span class=\"hljs-string\">final</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"48,54"}}],"payload":{"tag":"h2","lines":"46,47"}},{"content":"Gates: Programmatic Checks Between Steps","children":[{"content":"When to Gate","children":[],"payload":{"tag":"h3","lines":"67,68"}},{"content":"Gate Examples from the Code","children":[{"content":"<pre data-lines=\"78,82\"><code class=\"language-python\"><span class=\"hljs-keyword\">if</span> point_count &lt; <span class=\"hljs-number\">2</span>:\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;Chain stopped: extraction failed&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"78,82"}},{"content":"<pre data-lines=\"84,90\"><code class=\"language-python\"><span class=\"hljs-keyword\">try</span>:\n    metadata = json.loads(cleaned)\n<span class=\"hljs-keyword\">except</span> json.JSONDecodeError:\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;Chain stopped: invalid JSON&quot;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"84,90"}}],"payload":{"tag":"h3","lines":"75,76"}}],"payload":{"tag":"h2","lines":"63,64"}},{"content":"Multi-Input Steps","children":[{"content":"<pre data-lines=\"99,104\"><code class=\"language-python\"><span class=\"hljs-comment\"># Step 4 gets output from BOTH step 2 and step 3</span>\nfinal = call_gemini(POLISH_SYSTEM,\n    <span class=\"hljs-string\">f&quot;Original draft:\\n<span class=\"hljs-subst\">{draft}</span>\\n\\nEditor feedback:\\n<span class=\"hljs-subst\">{critique}</span>&quot;</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"99,104"}}],"payload":{"tag":"h2","lines":"95,96"}},{"content":"Four Patterns","children":[{"content":"<table data-lines=\"111,117\">\n<thead data-lines=\"111,112\">\n<tr data-lines=\"111,112\">\n<th>Pattern</th>\n<th>Structure</th>\n<th>Use case</th>\n</tr>\n</thead>\n<tbody data-lines=\"113,117\">\n<tr data-lines=\"113,114\">\n<td>Simple chain</td>\n<td>call &#x2192; call &#x2192; call</td>\n<td>Quick pipelines, prototyping</td>\n</tr>\n<tr data-lines=\"114,115\">\n<td>Gated chain</td>\n<td>call &#x2192; gate &#x2192; call &#x2192; call</td>\n<td>Production pipelines with quality checks</td>\n</tr>\n<tr data-lines=\"115,116\">\n<td>Multi-input step</td>\n<td>step3 uses output from step1 + step2</td>\n<td>Steps needing broader context</td>\n</tr>\n<tr data-lines=\"116,117\">\n<td>JSON gate</td>\n<td>call(&#x2192;JSON) &#x2192; json.loads() &#x2192; call</td>\n<td>Structured data passing between steps</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"111,117"}}],"payload":{"tag":"h2","lines":"109,110"}},{"content":"Error Handling","children":[{"content":"<strong>Fail fast</strong> (what we built): Return error immediately","children":[],"payload":{"tag":"li","lines":"125,126"}},{"content":"<strong>Retry</strong>: Try the failed step again, possibly with a modified prompt","children":[],"payload":{"tag":"li","lines":"126,128"}}],"payload":{"tag":"h2","lines":"120,121"}},{"content":"From the Code Run","children":[{"content":"1. <strong>Extract</strong>: 4 specific key points (accuracy, cost, debuggability, modularity)","children":[],"payload":{"tag":"li","lines":"133,134","listIndex":1}},{"content":"2. <strong>Gate</strong>: Passed (4 &gt;= 2)","children":[],"payload":{"tag":"li","lines":"134,135","listIndex":2}},{"content":"3. <strong>Draft</strong>: A complete blog post covering all points","children":[],"payload":{"tag":"li","lines":"135,136","listIndex":3}},{"content":"4. <strong>Critique</strong>: 5 specific improvements (add concrete example, acknowledge cost tradeoff, better analogy, split dense paragraph, mention tools)","children":[],"payload":{"tag":"li","lines":"136,137","listIndex":4}},{"content":"5. <strong>Polish</strong>: Rewrote incorporating all 5 critiques &#x2014; added a concrete prompt example, acknowledged the cost nuance, split the modularity section out","children":[],"payload":{"tag":"li","lines":"137,139","listIndex":5}}],"payload":{"tag":"h2","lines":"130,131"}},{"content":"Connection to Other Topics","children":[{"content":"<strong>Topic 5</strong>: The concept &#x2014; now implemented in code","children":[],"payload":{"tag":"li","lines":"145,146"}},{"content":"<strong>Topic 15</strong>: The Gemini API calls are the building blocks","children":[],"payload":{"tag":"li","lines":"146,147"}},{"content":"<strong>Topic 17</strong>: Each step is a fresh call, so no context window concern per step","children":[],"payload":{"tag":"li","lines":"147,148"}},{"content":"<strong>Topic 19 (next)</strong>: Routing adds conditional paths &#x2014; output determines which step runs next","children":[],"payload":{"tag":"li","lines":"148,149"}},{"content":"<strong>Topic 20</strong>: State management &#x2014; using a dictionary to organize intermediate results across steps","children":[],"payload":{"tag":"li","lines":"149,151"}}],"payload":{"tag":"h2","lines":"143,144"}}],"payload":{"tag":"h1","lines":"0,1"}},null)</script>
</body>
</html>
